# Data Anonymization Rules Configuration
# Defines how each PII type should be anonymized.
#
# To use different rule sets per business/use case (e.g. ML metrics vs full privacy),
# use a preset or custom config at runtime instead of this file:
#   CLI:  --preset ml_training   or  --preset gdpr_compliant  or  --config path/to.yaml
#   Code: load_config(Path("config/presets/ml_training.yaml"))
# Presets: config/presets/ (ml_training, gdpr_compliant, vendor_sharing)

version: "1.0"
description: "Default Anonymization rules for common PII types"

# Anonymization strategies:
# - Hash: SHA256 hash with optional salt
# - redact_full: Complete removal/masking
# - redact_partial: Partial masking 
# - pseudonymize: Consistent fake data (same input -> same output)
# - generalize: Convert specific values to ranges/categories

rules:
  # Contact Information
  email:
    strategy: hash
    parameters:
      salt: true
      algorithm: sha256
    preserve_domain: false  # Set to true to preserve domain for analytics
  
  phone:
    strategy: redact_partial
    parameters:
      visible_chars: 3  # Last 3 digits visible
      mask_char: "*"
  
  # Identifiers
  ssn:
    strategy: redact_full
    parameters:
      replacement: "[REDACTED-SSN]"
  
  credit_card:
    strategy: redact_partial
    parameters:
      visible_chars: 4  # Last 4 digits (industry standard)
      mask_char: "*"
  
  # Personal Data
  name:
    strategy: pseudonymize
    parameters:
      seed_based: true  # Same name always produces same pseudonym
      locale: "en_US"
  
  address:
    strategy: pseudonymize
    parameters:
      seed_based: true
      level: street  # Options: full, street, city, state
  
  # Demographic Data
  age:
    strategy: generalize
    parameters:
      bin_size: 10  # 10-year ranges (e.g., 30-39)
      min_value: 18
      max_value: 100
  
  date_of_birth:
    strategy: generalize
    parameters:
      granularity: year  # Options: day, week, month, quarter, year
  
  dob:  # Alias for date_of_birth
    strategy: generalize
    parameters:
      granularity: year
  
  # Marital status - sensitive attribute that can enable re-identification
  marital_status:
    strategy: generalize
    parameters:
      categories:
        - "Single"           # Never married
        - "Married/Partnered"  # Groups Married + Domestic Partnership
        - "Previously Married"  # Groups Divorced + Separated + Widowed
      rare_threshold: 5  # Generalize rare statuses for k-anonymity
      mapping:
        "Single": "Single"
        "Married": "Married/Partnered"
        "Domestic Partnership": "Married/Partnered"
        "Divorced": "Previously Married"
        "Separated": "Previously Married"
        "Widowed": "Previously Married"
  
  income:
    strategy: generalize
    parameters:
      bin_size: 25000  # $25k ranges for better k-anonymity
      min_value: 0
      max_value: 500000
  
  # Location Data
  zipcode:
    strategy: generalize
    parameters:
      precision: 3  # Keep first 3 digits (100** format)
  
  city:
    strategy: pseudonymize
    parameters:
      seed_based: true
      preserve_state: true  # Keep in same state
  
  ip_address:
    strategy: generalize
    parameters:
      octets: 2  # Keep first 2 octets (192.168.*.*)
  
  # Other
  user_id:
    strategy: hash
    parameters:
      salt: true
      algorithm: sha256
  
  # Gender - generalize to preserve utility while protecting rare categories
  gender:
    strategy: generalize
    parameters:
      categories:
        - "Male"
        - "Female"
        - "Other"  # Groups Non-binary, Prefer not to say for k-anonymity
      rare_threshold: 5  # Generalize if fewer than 5 records
  
  # Race - highly sensitive, requires careful generalization for k-anonymity
  race:
    strategy: generalize
    parameters:
      categories:
        - "White"
        - "Black or African American"
        - "Asian"
        - "Other"  # Groups smaller categories to prevent re-identification
      rare_threshold: 10  # Higher threshold for this sensitive attribute
      mapping:
        "White": "White"
        "Black or African American": "Black or African American"
        "Asian": "Asian"
        "American Indian or Alaska Native": "Other"
        "Native Hawaiian or Pacific Islander": "Other"
        "Two or More Races": "Other"
  
  # Ethnicity - sensitive attribute, separate from race per US Census
  ethnicity:
    strategy: generalize
    parameters:
      categories:
        - "Not Hispanic or Latino"
        - "Hispanic or Latino"  # Consolidate all Hispanic subcategories
      rare_threshold: 10
      mapping:
        "Not Hispanic or Latino": "Not Hispanic or Latino"
        "Hispanic or Latino - Mexican": "Hispanic or Latino"
        "Hispanic or Latino - Puerto Rican": "Hispanic or Latino"
        "Hispanic or Latino - Cuban": "Hispanic or Latino"
        "Hispanic or Latino - Other": "Hispanic or Latino"
  
  # Location History - contains sensitive travel data
  location_history:
    strategy: generalize
    parameters:
      level: country  # Options: exact, city, country, region
      remove_coordinates: true  # Strip lat/lng
      remove_dates: false  # Keep dates for temporal analysis
      max_locations: 5  # Limit number of locations shown
  
  # Device/OS Data
  os_name:
    strategy: generalize
    parameters:
      level: family  # Options: exact, family (Windows/macOS/iOS/Android/Linux)
  
  os_version:
    strategy: redact_full
    parameters:
      replacement: "[VERSION]"  # Version numbers can fingerprint users
  
  device_type:
    strategy: preserve  # Low sensitivity - desktop/mobile/tablet
    parameters:
      allowed_values: ["desktop", "mobile", "tablet"]

# Global settings
global:
  handle_nulls: true  # How to handle null/missing values
  null_replacement: null  # Keep as null or use "[NULL]"
  preserve_data_types: true  # Maintain original data types where possible
  case_sensitive: false  # For pattern matching

# Validation settings
validation:
  required_fields: ["strategy"]
  allowed_strategies:
    - hash
    - redact_full
    - redact_partial
    - pseudonymize
    - generalize
  
  # Strategy-specific parameter requirements
  required_parameters:
    generalize: ["bin_size", "min_value", "max_value"]
    redact_partial: ["visible_chars", "mask_char"]
    pseudonymize: ["seed_based"]
    hash: ["algorithm"] 
